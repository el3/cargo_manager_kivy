from kivy.app import App
from kivy.uix.relativelayout import RelativeLayout
from kivy.uix.widget import Widget
from kivy.uix.scatter import Scatter
from kivy.properties import NumericProperty
from kivy.graphics import Color, Ellipse
from kivy.lang import Builder
from kivy.clock import Clock

from widgets import Space

class Hold(RelativeLayout):
    positions = [[[0, 798], [60, 798], [120, 798], [180, 798], [240, 798], [300, 798], [360, 798], [420, 798], [480, 798], [540,
                                                                                                                   798], [
             600, 798], [660, 798], [720, 798], [780, 798], [0, 758], [60, 758], [120, 758], [180, 758], [240, 758], [
             300, 758], [360, 758], [420, 758], [480, 758], [540, 758], [600, 758], [660, 758], [720, 758], [780,
                                                                                                             758], [0,
                                                                                                                    718], [
             60, 718], [120, 718], [180, 718], [240, 718], [300, 718], [360, 718], [420, 718], [480, 718], [540, 718], [
             600, 718], [660, 718], [720, 718], [780, 718], [840, 718], [900, 718], [960, 718], [1020, 718], [1080,
                                                                                                              718], [0,
                                                                                                                     678], [
             60, 678], [120, 678], [180, 678], [240, 678], [300, 678], [360, 678], [420, 678], [480, 678], [540, 678], [
             600, 678], [660, 678], [720, 678], [780, 678], [840, 678], [900, 678], [960, 678], [1020, 678], [1080,
                                                                                                              678], [0,
                                                                                                                     638], [
             60, 638], [120, 638], [180, 638], [240, 638], [300, 638], [360, 638], [420, 638], [480, 638], [540, 638], [
             600, 638], [660, 638], [720, 638], [780, 638], [840, 638], [900, 638], [960, 638], [1020, 638], [1080,
                                                                                                              638], [
             1140, 638], [1200, 638], [1260, 638], [1320, 638], [1380, 638], [1440, 638], [0, 598], [60, 598], [120,
                                                                                                                598], [
             180, 598], [240, 598], [300, 598], [360, 598], [420, 598], [480, 598], [540, 598], [600, 598], [660,
                                                                                                             598], [720,
                                                                                                                    598], [
             780, 598], [840, 598], [900, 598], [960, 598], [1020, 598], [1080, 598], [1140, 598], [1200, 598], [1260,
                                                                                                                 598], [
             1320, 598], [1380, 598], [1440, 598], [0, 558], [60, 558], [120, 558], [240, 558], [300, 558], [360,
                                                                                                             558],

                  [480, 558],
                  [540,558], [600, 558],

                  #[660, 558],

                  [780, 558], [840, 558], [900, 558], [1020, 558], [1080, 558], [1140, 558], [1260,
                                                                                                                558], [
             1320, 558], [1380, 558], [0, 518], [60, 518], [120, 518], [180, 518], [240, 518], [300, 518], [360, 518], [
             420, 518], [480, 518], [540, 518], [600, 518], [660, 518], [720, 518], [780, 518], [840, 518], [900,
                                                                                                             518], [960,
                                                                                                                    518], [
             1020, 518], [1080, 518], [1140, 518], [1200, 518], [1260, 518], [1320, 518], [1380, 518], [1440, 518], [
             1500, 518], [1560, 518], [1620, 518], [0, 478], [60, 478], [120, 478], [180, 478], [240, 478], [300,
                                                                                                             478], [360,
                                                                                                                    478], [
             420, 478], [480, 478], [540, 478], [600, 478], [660, 478], [720, 478], [780, 478], [840, 478], [900,
                                                                                                             478], [960,
                                                                                                                    478], [
             1020, 478], [1080, 478], [1140, 478], [1200, 478], [1260, 478], [1320, 478], [1380, 478], [1440, 478], [
             1500, 478], [1560, 478], [1620, 478], [0, 438], [60, 438], [120, 438], [180, 438], [240, 438], [300,
                                                                                                             438], [360,
                                                                                                                    438], [
             420, 438], [480, 438], [540, 438], [600, 438], [660, 438], [720, 438], [780, 438], [840, 438], [900,
                                                                                                             438], [960,
                                                                                                                    438], [
             1020, 438], [1080, 438], [1140, 438], [1200, 438], [1260, 438], [1320, 438], [1380, 438], [1440, 438], [
             1500, 438], [1560, 438], [1620, 438], [0, 398], [60, 398], [120, 398], [180, 398], [240, 398], [300,
                                                                                                             398], [360,
                                                                                                                    398], [
             420, 398], [480, 398], [540, 398], [600, 398], [660, 398], [720, 398], [780, 398], [840, 398], [900,
                                                                                                             398], [960,
                                                                                                                    398], [
             1020, 398], [1080, 398], [1140, 398], [1200, 398], [1260, 398], [1320, 398], [1380, 398], [1440, 398], [
             1500, 398], [1560, 398], [1620, 398], [0, 358], [60, 358], [120, 358], [180, 358], [240, 358], [300,
                                                                                                             358], [360,
                                                                                                                    358], [
             420, 358], [480, 358], [540, 358], [600, 358], [660, 358], [720, 358], [780, 358], [840, 358], [900,
                                                                                                             358], [960,
                                                                                                                    358], [
             1020, 358], [1080, 358], [1140, 358], [1200, 358], [1260, 358], [1320, 358], [1380, 358], [1440, 358], [
             1500, 358], [1560, 358], [1620, 358], [0, 318], [60, 318], [120, 318], [180, 318], [240, 318], [300,
                                                                                                             318], [360,
                                                                                                                    318], [
             420, 318], [480, 318], [540, 318], [600, 318], [660, 318], [720, 318], [780, 318], [840, 318], [900,
                                                                                                             318], [960,
                                                                                                                    318], [
             1020, 318], [1080, 318], [1140, 318], [1200, 318], [1260, 318], [1320, 318], [1380, 318], [1440, 318], [
             1500, 318], [1560, 318], [1620, 318], [0, 278], [60, 278], [120, 278], [240, 278], [300, 278],

                  [360,278],
                  [480, 278],
                  [540,278],
                  [600, 278],
                  #[660, 278],

                  [780, 278], [840, 278], [900, 278], [1020, 278], [1080, 278], [1140, 278], [1260,
                                                                                                                278], [
             1320, 278], [1380, 278], [0, 238], [60, 238], [120, 238], [180, 238], [240, 238], [300, 238], [360, 238], [
             420, 238], [480, 238], [540, 238], [600, 238], [660, 238], [720, 238], [780, 238], [840, 238], [900,
                                                                                                             238], [960,
                                                                                                                    238], [
             1020, 238], [1080, 238], [1140, 238], [1200, 238], [1260, 238], [1320, 238], [1380, 238], [1440, 238], [0,
                                                                                                                     198], [
             60, 198], [120, 198], [180, 198], [240, 198], [300, 198], [360, 198], [420, 198], [480, 198], [540, 198], [
             600, 198], [660, 198], [720, 198], [780, 198], [840, 198], [900, 198], [960, 198], [1020, 198], [1080,
                                                                                                              198], [
             1140, 198], [1200, 198], [1260, 198], [1320, 198], [1380, 198], [1440, 198], [0, 158], [60, 158], [120,
                                                                                                                158], [
             180, 158], [240, 158], [300, 158], [360, 158], [420, 158], [480, 158], [540, 158], [600, 158], [660,
                                                                                                             158], [720,
                                                                                                                    158], [
             780, 158], [840, 158], [900, 158], [960, 158], [1020, 158], [1080, 158], [0, 118], [60, 118], [120, 118], [
             180, 118], [240, 118], [300, 118], [360, 118], [420, 118], [480, 118], [540, 118], [600, 118], [660,
                                                                                                             118], [720,
                                                                                                                    118], [
             780, 118], [840, 118], [900, 118], [960, 118], [1020, 118], [1080, 118], [0, 78], [60, 78], [120, 78], [
             180, 78], [360, 78], [420, 78], [480, 78], [540, 78], [600, 78], [660, 78], [720, 78], [780, 78], [0,
                                                                                                                38], [
             60, 38], [120, 38], [180, 38], [360, 38], [420, 38], [480, 38], [540, 38], [600, 38], [660, 38], [720,
                                                                                                               38], [
             780, 38]],[[0, 800],[60, 800],[120, 800],[180, 800],[240, 800],[300, 800],[360, 800],[420, 800],[600, 800],[660, 800],[720, 800],[780, 800],[840, 800],[0, 760],[60, 760],[120, 760],[180, 760],[240, 760],[300, 760],[360, 760],[420, 760],[600, 760],[660, 760],[720, 760],[780, 760],[840, 760],[900, 760],[960, 760],[1020, 760],[1080, 760],[1140, 760],[1200, 760],[1260, 760],[0, 720],[60, 720],[120, 720],[180, 720],[240, 720],[300, 720],[360, 720],[420, 720],[480, 720],[540, 720],[600, 720],[660, 720],[720, 720],[780, 720],[840, 720],[900, 720],[960, 720],[1020, 720],[1080, 720],[1140, 720],[1200, 720],[1260, 720],[1320, 720],[1380, 720],[1440, 720],[0, 680],[60, 680],[120, 680],[180, 680],[240, 680],[300, 680],[360, 680],[420, 680],[480, 680],[540, 680],[600, 680],[660, 680],[720, 680],[780, 680],[840, 680],[900, 680],[960, 680],[1020, 680],[1080, 680],[1140, 680],[1200, 680],[1260, 680],[1320, 680],[1380, 680],[0, 640],[60, 640],[120, 640],[180, 640],[240, 640],[300, 640],[360, 640],[420, 640],[480, 640],[540, 640],[600, 640],[660, 640],[720, 640],[780, 640],[840, 640],[900, 640],[960, 640],[1020, 640],[1080, 640],[1140, 640],[1200, 640],[1260, 640],[1320, 640],[1380, 640],[0, 600],[60, 600],[120, 600],[180, 600],[240, 600],[300, 600],[360, 600],[420, 600],[480, 600],[540, 600],[600, 600],[660, 600],[720, 600],[780, 600],[840, 600],[900, 600],[960, 600],[1020, 600],[1080, 600],[1140, 600],[1200, 600],[1260, 600],[1320, 600],[1380, 600],[0, 560],[60, 560],[120, 560],[240, 560],[300, 560],[360, 560],[480, 560],[540, 560],[600, 560],[780, 560],[840, 560],[900, 560],[1020, 560],[1080, 560],[1140, 560],[1260, 560],[1320, 560],[1560, 560],[0, 520],[60, 520],[120, 520],[180, 520],[240, 520],[300, 520],[360, 520],[420, 520],[480, 520],[540, 520],[600, 520],[660, 520],[720, 520],[780, 520],[840, 520],[900, 520],[960, 520],[1020, 520],[1080, 520],[1140, 520],[1200, 520],[1260, 520],[1320, 520],[1380, 520],[1440, 520],[1500, 520],[1560, 520],[1620, 520],[0, 480],[60, 480],[120, 480],[180, 480],[240, 480],[300, 480],[360, 480],[420, 480],[480, 480],[540, 480],[600, 480],[660, 480],[720, 480],[780, 480],[840, 480],[900, 480],[960, 480],[1020, 480],[1080, 480],[1140, 480],[1200, 480],[1260, 480],[1320, 480],[1380, 480],[1440, 480],[1500, 480],[1560, 480],[1620, 480],[0, 440],[60, 440],[120, 440],[180, 440],[240, 440],[300, 440],[360, 440],[420, 440],[480, 440],[540, 440],[600, 440],[660, 440],[720, 440],[780, 440],[840, 440],[900, 440],[960, 440],[1020, 440],[1080, 440],[1140, 440],[1200, 440],[1260, 440],[1320, 440],[1380, 440],[1440, 440],[1500, 440],[1560, 440],[1620, 440],[0, 400],[60, 400],[120, 400],[180, 400],[240, 400],[300, 400],[360, 400],[420, 400],[480, 400],[540, 400],[600, 400],[660, 400],[720, 400],[780, 400],[840, 400],[900, 400],[960, 400],[1020, 400],[1080, 400],[1140, 400],[1200, 400],[1260, 400],[1320, 400],[1560, 400],[1620, 400],[0, 360],[60, 360],[120, 360],[180, 360],[240, 360],[300, 360],[360, 360],[420, 360],[480, 360],[540, 360],[600, 360],[660, 360],[720, 360],[780, 360],[840, 360],[900, 360],[960, 360],[1320, 360],[1560, 360],[1620, 360],[0, 320],[60, 320],[120, 320],[180, 320],[240, 320],[300, 320],[360, 320],[420, 320],[480, 320],[540, 320],[600, 320],[660, 320],[720, 320],[780, 320],[840, 320],[900, 320],[960, 320],[1320, 320],[1380, 320],[1440, 320],[1500, 320],[1560, 320],[1620, 320],[0, 280],[60, 280],[120, 280],[240, 280],[300, 280],[360, 280],[480, 280],[540, 280],[600, 280],[780, 280],[840, 280],[900, 280],[1020, 280],[1080, 280],[1140, 280],[1260, 280],[1320, 280],[1500, 280],[1560, 280],[1620, 280],[0, 240],[60, 240],[120, 240],[180, 240],[240, 240],[300, 240],[360, 240],[420, 240],[480, 240],[540, 240],[600, 240],[660, 240],[720, 240],[780, 240],[840, 240],[900, 240],[960, 240],[1020, 240],[1080, 240],[1140, 240],[1200, 240],[1260, 240],[1320, 240],[1380, 240],[1440, 240],[1620, 240],[0, 200],[60, 200],[120, 200],[180, 200],[240, 200],[300, 200],[360, 200],[420, 200],[480, 200],[540, 200],[600, 200],[660, 200],[720, 200],[780, 200],[840, 200],[900, 200],[960, 200],[1020, 200],[1080, 200],[1140, 200],[1200, 200],[1260, 200],[1320, 200],[1380, 200],[1440, 200],[0, 160],[60, 160],[120, 160],[180, 160],[240, 160],[300, 160],[360, 160],[420, 160],[480, 160],[540, 160],[600, 160],[660, 160],[720, 160],[780, 160],[840, 160],[900, 160],[960, 160],[1020, 160],[1260, 160],[1320, 160],[1380, 160],[0, 120],[60, 120],[120, 120],[180, 120],[240, 120],[300, 120],[360, 120],[420, 120],[480, 120],[540, 120],[600, 120],[660, 120],[720, 120],[780, 120],[840, 120],[900, 120],[960, 120],[1020, 120],[1380, 120],[0, 80],[60, 80],[120, 80],[180, 80],[240, 80],[300, 80],[360, 80],[420, 80],[480, 80],[540, 80],[600, 80],[660, 80],[720, 80],[780, 80],[840, 80],[900, 80],[960, 80],[1020, 80],[0, 40],[60, 40],[120, 40],[180, 40],[360, 40],[420, 40],[480, 40],[540, 40],[600, 40],[660, 40],[720, 40],[780, 40],[840, 40]]]

    hold = NumericProperty(0)

    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        Clock.schedule_once(self.init)

    def init(self,dt):
        #excludes = [171,367,536,537,8,36,37,9,175,371,375,376,179,180,184,380,384,188,191,192,388,387,15,16,17,18,19,20,21,22,23,24,25,26,27,55,54,53,52,51,50,83,82,81,111,110,109,108,139,138,137,136,167,166,165,164,193,195,547,548,549,550,551,552,553,554,555,556,557,558,559,531,530,529,528,527,526,525,524,496,495,494,466,467,468,523,522,497,498,472,500,501,473,474,502,503,475,447,446,445,417,418,303,304,305,333,332,331,325,353,354,326,355,327,356,328,329,357]
        #for y in range(38, 798+40, 40):
         #   for x in range(0,1620+60,60):
          #      self.positions.append([x,798+40-y])
        print(len(self.positions[0]),len(self.positions[1]))
        for ind,pos in enumerate(self.positions[self.hold]):
            p = Space(x=pos[0] * 1.03 + 3, y=pos[1] * 1.03 - 32)
            p._add_pallet(0)
            p._add_pallet(1)
            self.add_widget(p)

    def layer(self):
        for i in self.children:
            if isinstance(i, Space):
                top = i.children[0]
                if top.active:
                    top.alpha = .2


class Support(Widget):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)
        with self.canvas:
            for i in range(24):
                Color(rgba=(.5, .5, .5, i/(24*4)))
                Ellipse(pos=(self.x-i,self.y+i), size=self.size)
            Color(rgba=(.4, .4, .4, 1))
            Ellipse(pos=(self.x-i,self.y+i), size=self.size)

class Holds(Scatter):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        Clock.schedule_once(self.init)
    def init(self,dt):
        supports_x = (450,450+540, 450+540*2, 450+540*3, 450+540*3+480, 450+540*3+480*2)
        supports_y = (562, 562+560)
        for y in supports_y:
            for x in supports_x:
                self.add_widget(Support(x=x/2-10, y=y/2-10))



Builder.load_string("""
<-FullImage@Image>:
    canvas:
        Color:
            rgba: (1, 1, 1, .5)
        Rectangle:
            texture: self.texture
            size: self.width + 20, self.height + 20
            pos: self.x - 10, self.y - 10

<Hold>:
    source: ""
    size_hint: None, None
    size: 1740, 838
    x: 20
    hold: 0
    canvas.before:
        Color:
            rgba: 1,1,1,.5
        Line:
            rectangle: (0,0,*self.size)
    #FullImage:
     #   source: root.source
            
<Support>:
    size_hint: None, None
    size: 20, 20
    
<Holds>:
    sm: sm
    auto_bring_to_front: False
    id: suppo
    lowerhold: lowerhold
    upperhold: upperhold   
    ScreenManager:
        id: sm
        size_hint: None, None
        size: 1760, 858
        Screen:
            name: "lowerhold"
            Hold:
                source: "assets/upperhold.png"
                id: lowerhold
                hold: 0       
        Screen:
            name: "upperhold"
            Hold:
                id: upperhold
                hold: 1
""")